import pandas as _pd
import pathlib as _pl

import unittest as _ut

import optihood as _oh

from optihood.writers import groupScenarioWriter as _gsw


class TestGroupScenarioWriter(_ut.TestCase):
    # def setUp(self) -> None:

    def test_example_output(self):
        packageDir = _pl.Path(_oh.__file__).resolve().parent
        config_file_path = packageDir / ".." / "data" / "configs" / "basic_example_config" / "scenario_HP_GS_PV_group.ini"
        excel_file_path = "will_not_be_used.xls"

        data = _gsw.createScenarioFile(0, config_file_path, excel_file_path, numberOfBuildings=4, writeToFileOrReturnData='data')
        print(data)

        expected_data = "##teamcity[testStdOut timestamp='2024-03-19T17:42:12.823' flowId='test_scenario_writers.TestGroupScenarioWriter.test_example_output' locationHint='python<C:\Users\alex.hobe\Projects\optihood\tests\test_writers>://test_scenario_writers.TestGroupScenarioWriter.test_example_output' name='test_example_output' nodeId='3' out='{|'commodity_sources|':                  label  ...  active|n0  electricityResource  ...       1|n1  electricityResource  ...       1|n2  electricityResource  ...       1|n3  electricityResource  ...       1|n|n|[4 rows x 6 columns|], |'solar|':   label  building from  ... elec_impact impact_cap active|n0    pv         1       ...           0       1131      1|n1    pv         2       ...           0       1131      1|n2    pv         3       ...           0       1131      1|n3    pv         4       ...           0       1131      1|n|n|[4 rows x 28 columns|], |'demand|':                      label  building active  ... fixed nominal value building model|n0        electricityDemand         1      1  ...     1             1            NaN|n1        electricityDemand         2      1  ...     1             1            NaN|n2        electricityDemand         3      1  ...     1             1            NaN|n3        electricityDemand         4      1  ...     1             1            NaN|n4       spaceHeatingDemand         1      1  ...     1             1            NaN|n5       spaceHeatingDemand         2      1  ...     1             1            NaN|n6       spaceHeatingDemand         3      1  ...     1             1            NaN|n7       spaceHeatingDemand         4      1  ...     1             1            NaN|n8   domesticHotWaterDemand         1      1  ...     1             1            NaN|n9   domesticHotWaterDemand         2      1  ...     1             1            NaN|n10  domesticHotWaterDemand         3      1  ...     1             1            NaN|n11  domesticHotWaterDemand         4      1  ...     1             1            NaN|n|n|[12 rows x 7 columns|], |'transformers|':   label  building active  ... heat_impact elec_impact impact_cap|n0    HP         1      1  ...           0           0      280.9|n1    HP         2      1  ...           0           0      280.9|n2    HP         3      1  ...           0           0      280.9|n3    HP         4      1  ...           0           0      280.9|n4  GWHP         1      1  ...           0           0        772|n5  GWHP         2      1  ...           0           0        772|n6  GWHP         3      1  ...           0           0        772|n7  GWHP         4      1  ...           0           0        772|n|n|[8 rows x 19 columns|], |'storages|':                 label  building active  ... heat_impact elec_impact impact_cap|n0   electricalStorage         1      1  ...           0           0      28.66|n1   electricalStorage         2      1  ...           0           0      28.66|n2   electricalStorage         3      1  ...           0           0      28.66|n3   electricalStorage         4      1  ...           0           0      28.66|n4           shStorage         1      1  ...           0           0       0.49|n5           shStorage         2      1  ...           0           0       0.49|n6           shStorage         3      1  ...           0           0       0.49|n7           shStorage         4      1  ...           0           0       0.49|n8          dhwStorage         1      1  ...           0           0       0.49|n9          dhwStorage         2      1  ...           0           0       0.49|n10         dhwStorage         3      1  ...           0           0       0.49|n11         dhwStorage         4      1  ...           0           0       0.49|n|n|[12 rows x 20 columns|], |'stratified_storage|':         label diameter temp_h temp_c  ... s_iso lamb_iso alpha_inside alpha_outside|n0   shStorage        1     35     15  ...   100     0.03          100            10|n1  dhwStorage        1     60     15  ...   100     0.03          100            10|n|n|[2 rows x 11 columns|], |'links|':              label active efficiency invest_base invest_cap investment|n0  electricityLink      1     0.9999           0          0          1|n0           shLink      1        0.9           0          0          1|n0          dhwLink      1        0.9           0          0          1, |'profiles|':               name                                     path|n0     weather_data         ..\excels\clustering\weather.csv|n0  demand_profiles  ..\excels\basic_example\demand_profiles, |'grid_connection|':                   label  building  ...                to efficiency|n0       gridElectricity         1  ...  electricityInBus          1|n1       gridElectricity         2  ...  electricityInBus          1|n2       gridElectricity         3  ...  electricityInBus          1|n3       gridElectricity         4  ...  electricityInBus          1|n4     electricitySource         1  ...    electricityBus          1|n5     electricitySource         2  ...    electricityBus          1|n6     electricitySource         3  ...    electricityBus          1|n7     electricitySource         4  ...    electricityBus          1|n8   producedElectricity         1  ...  electricityInBus          1|n9   producedElectricity         2  ...  electricityInBus          1|n10  producedElectricity         3  ...  electricityInBus          1|n11  producedElectricity         4  ...  electricityInBus          1|n12     domesticHotWater         1  ...      dhwDemandBus          1|n13     domesticHotWater         2  ...      dhwDemandBus          1|n14     domesticHotWater         3  ...      dhwDemandBus          1|n15     domesticHotWater         4  ...      dhwDemandBus          1|n16             shSource         1  ...   spaceHeatingBus          1|n17             shSource         2  ...   spaceHeatingBus          1|n18             shSource         3  ...   spaceHeatingBus          1|n19             shSource         4  ...   spaceHeatingBus          1|n20         spaceHeating         1  ...       shDemandBus          1|n21         spaceHeating         2  ...       shDemandBus          1|n22         spaceHeating         3  ...       shDemandBus          1|n23         spaceHeating         4  ...       shDemandBus          1|n|n|[24 rows x 5 columns|], |'buses|':                   label  building excess excess costs active|n0               gridBus         1      0          NaN      1|n1               gridBus         2      0          NaN      1|n2               gridBus         3      0          NaN      1|n3               gridBus         4      0          NaN      1|n4    electricityProdBus         1      0          NaN      1|n5    electricityProdBus         2      0          NaN      1|n6    electricityProdBus         3      0          NaN      1|n7    electricityProdBus         4      0          NaN      1|n8      electricityInBus         1      0          NaN      1|n9      electricityInBus         2      0          NaN      1|n10     electricityInBus         3      0          NaN      1|n11     electricityInBus         4      0          NaN      1|n12          shDemandBus         1      0          NaN      1|n13          shDemandBus         2      0          NaN      1|n14          shDemandBus         3      0          NaN      1|n15          shDemandBus         4      0          NaN      1|n16         dhwDemandBus         1      0          NaN      1|n17         dhwDemandBus         2      0          NaN      1|n18         dhwDemandBus         3      0          NaN      1|n19         dhwDemandBus         4      0          NaN      1|n20          shSourceBus         1      0          NaN      1|n21          shSourceBus         2      0          NaN      1|n22          shSourceBus         3      0          NaN      1|n23          shSourceBus         4      0          NaN      1|n24        dhwStorageBus         1      0          NaN      1|n25        dhwStorageBus         2      0          NaN      1|n26        dhwStorageBus         3      0          NaN      1|n27        dhwStorageBus         4      0          NaN      1|n28       electricityBus         1      1        -0.09      1|n29       electricityBus         2      1        -0.09      1|n30       electricityBus         3      1        -0.09      1|n31       electricityBus         4      1        -0.09      1|n32      spaceHeatingBus         1      0          NaN      1|n33      spaceHeatingBus         2      0          NaN      1|n34      spaceHeatingBus         3      0          NaN      1|n35      spaceHeatingBus         4      0          NaN      1|n36  domesticHotWaterBus         1      0          NaN      1|n37  domesticHotWaterBus         2      0          NaN      1|n38  domesticHotWaterBus         3      0          NaN      1|n39  domesticHotWaterBus         4      0          NaN      1}' parentNodeId='2']"
        self.assertEqual(data, expected_data)  # add assertion here


if __name__ == '__main__':
    _ut.main()
